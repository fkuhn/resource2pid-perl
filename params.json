{"name":"Resource2pid-perl","tagline":"Perl and CGI version of resource2pid to function with older server infrastructures","body":"# resource2pid version 1.0\r\n## A script collection to retrieve handle.net PIDs for IDS repository resources.\r\n\r\n## Date: Jan 16 2016\r\n\r\n### Tested OS Environment:\r\n\r\n#### os and software\r\nubuntu 15.10\r\nperl v5.20.2\r\nApache/2.4.12 (Ubuntu)\r\nmysql  Ver 14.14 Distrib 5.6.27\r\n\r\n#### perl modules\r\nDBI 1.634\r\nCGI 4.25\r\n\r\n\r\n### Files \r\n\r\n./resource2pid/\r\n README.md\r\n \r\n backups/\r\n    dgdhandles_backup.csv\r\n    handles_backup.txt\r\n \r\n cgi/\r\n    retrieve_handle-csv.cgi\r\n    retrieve_handle-mysql.cgi\r\n \r\n cron/\r\n    handles2mysql.pl\r\n    handles2csv.pl\r\n \r\n data/\r\n    handles.csv\r\n    handles-raw.txt\r\n \r\n tool/\r\n    pid-cmdline-0.0.3.jar\r\n    \r\n### File Description\r\n\r\n#### cgi -- cgi scripts for repository resource to handle pid mapping\r\n - retrieve_handle-csv.cgi: cgi query handling with handles stored in the csv file.\r\n - retrieve_handles-mysql.cgi: cgi script for query handling of handles with mysql.\r\n\r\n#### cron -- scripts that need to be run periodically with cron\r\n- handles2csv.pl: retrieve handles and write them to a csv file.\r\n- handles2mysql.pl: retrieve handles and store them in a mysql db table.\r\n\r\n#### data -- data used by the csv version of the scripts\r\n - handles.csv: a handle to resource item mapping as comma separated file.\r\n - handles_raw.txt: raw data of retrieved handles.\r\n \r\n#### tool -- the command line tool for pid retrieval\r\n - pid-cmdline-0.0.3.jar: java jar of the command line tool needed to retrieve \r\n   handle pids. its called in both handles2csv.pl and handles2mysql.pl \r\n\r\n#### backups -- backups of the csv related data files\r\n - handles_backup.csv: backup of csv handle file\r\n - handles-raw_backup.txt: backup of txt handle file \r\n\r\n\r\n## retrieve_handle-csv.cgi\r\n\r\nPass the dgd id of a resource in the webbrowser:\r\nhttp://hostname/cgi-bin/dgdhandles-csv.cgi?PF--_E_00001\r\nThis finds the \r\n\r\n\r\n## retrieve_handle-mysql.cgi\r\n\r\nThis is the mysql version of dgdhandles-csv. instead of retrieving the\r\ncorrect handle.net pid of a dgd item from a csv file, the script consults\r\na mysql database holding the same stock of information.\r\nThe database is populated by calling the script _handles2mysql.pl_.\r\nIt is strongly recommended to use this version.\r\n\r\n\r\n## Installation and usage\r\n\r\n\r\n### Prerequisites and MySQL \r\n\r\n1. Copy the contents of folders cgi/ and handles.csv found in data/ to your \r\ncgi-bin directory (e.g. /usr/lib/cgi-bin). \r\n\r\n2. Make sure the cgi files are executable for others, e.g.:\r\n\t\t\r\n\t\t$chmod a+x retrieve_handle-mysql.cgi \r\n\r\n3. Define a mysql database and a handleuser and grant permissions and make\r\n   sure the permissions take effect:\r\n   You need to login to mysql as root (mysql -u root -p)\r\n    \r\n    mysql> CREATE DATABASE handles;\r\n    Query OK, 1 row affected (0,00 sec)\r\n\r\n    mysql> CREATE USER handleuser@localhost IDENTIFIED BY 'handlepassword';\r\n    Query OK, 0 rows affected (0,04 sec)\r\n\r\n    mysql> GRANT ALL ON handles.* TO handleuser@localhost;\r\n    Query OK, 0 rows affected (0,03 sec)\r\n    \r\n    mysql> FLUSH PRIVILEGES;\r\n    Query OK, 0 rows affected (0,00 sec)\r\n\r\n    mysql> CREATE TABLE handles.handletable(\r\n        item VARCHAR(200) DEFAULT NULL,\r\n        pidurl VARCHAR(200) DEFAULT NULL);\r\n    Query OK, 0 rows affected (0,35 sec)\r\n\r\n\r\n\tNOTE: This example user will only be accessible via localhost. You\r\n\twill have to change addresses accordingly if you need to access the\r\n\tuser remotely.\r\n\r\n4. \tCopy the contens of cron/ and tool/ to your preferred directory.\r\n\tThe files pid-cmdline-0.0.3.jar and handles2mysql.pl must be located in the same directory\r\n\tBoth files must be executable.\r\n\r\n4. To initially populate the database and its table with values, call \r\n\t\t\r\n\t\t$perl handles2mysql.pl\r\n\r\n5. You can check if everything went well via logging in with \r\n\t\tmysql -u handleuser -p\r\n\t\t\r\n\tand call:\r\n\t\r\n\t\tmysql> USE handles;\r\n\t\tReading table information for completion of table and column names\r\n\t\tYou can turn off this feature to get a quicker startup with -A\r\n\r\n\t\tDatabase changed\r\n\t\t\r\n\tand:\r\n\t\r\n\t\tmysql> SHOW TABLE STATUS;\r\n\t\t\r\n\twhich should return something like:\r\n\t+-------------+--------+---------+------------+-------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+-------------+------------+-------------------+----------+----------------+---------+\r\n\t| Name        | Engine | Version | Row_format | Rows  | Avg_row_length | Data_length | Max_data_length | Index_length | Data_free | Auto_increment | Create_time         | Update_time | Check_time | Collation         | Checksum | Create_options | Comment |\r\n\t+-------------+--------+---------+------------+-------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+-------------+------------+-------------------+----------+----------------+---------+\r\n\t| handletable | InnoDB |      10 | Compact    | 35196 |            223 |     7880704 |               0 |            0 |   4194304 |           NULL | 2016-01-13 12:45:33 | NULL        | NULL       | latin1_swedish_ci |     NULL |                |         |\r\n\t+-------------+--------+---------+------------+-------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+-------------+------------+-------------------+----------+----------------+---------+\r\n\t1 row in set (0,01 sec)\r\n\t\r\n\t\t\r\n\treturn to your terminal with \"exit\"\r\n\r\n### Enable and test CGI\r\n \r\n6.\tIf not done before, you will have to enable cgi (with perl)for your apache2 \r\n\twebserver.\r\n\t\r\n7.\tHow to activate the apache2 webserver cgi and perl modules on ubuntu:\r\n\t\t$sudo a2enmod cgi\r\n\t\t$sudo a2enmod perl\r\n\t\r\n8. \tRestart your Apache Webserver:\r\n\r\n\t\t$ sudo service apache2 restart\r\n\r\n9. For this example installation, you should now be able to open a browser window\r\n   and enter a query url, for example:\r\n\t\t\r\n\t\thttp://localhost/cgi-bin/retrieve_handle-mysql.cgi?item=http://repos.ids-mannheim.de/fedora/objects/clarind-ids:mkhz.000066/datastreams/JPEG/content\r\n\r\n\tThe value of the \"item\" cgi-parameter is the resource-uri of an item in the database.\r\n\tSubmitting this query should simply return \r\n\t\r\n\t\thttp://hdl.handle.net/10932/00-017B-E105-ACD8-1101-B \r\n\r\n\twhich points to exactly the same resource via persistent identifier.\r\n\r\n\r\n### Enable cron to schedule handle pid updates\r\n\t\r\n10. To make the script handles2mysql.pl update all handle pids frequently\r\n\tyou can define a cronjob. For example, if you want the script to be\r\n\tcalled once a week, define a schedule with:\r\n\t\r\n\t\tcrontab -e \r\n\tand choose your editor.\r\n\tedit the opened file by adding the job in the crontab format, e.g.:\r\n\t\t\r\n\t\t0 5 * * mon perl /path/to/script/handles2mysq.pl\r\n\t\r\n\twill execute the script every monday at 5am. \r\n\r\n\r\n## Known Issues\r\n* URIs of AGD Resource are not found. MySQL query string issue.\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}